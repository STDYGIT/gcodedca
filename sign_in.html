<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sign-In</title>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <meta name="google-signin-client_id"
        content="1075773109360-rvvcrkes8lbir14cthkbugqus54iq3p7.apps.googleusercontent.com">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #080833;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
            background: #2d2d2d;
            border-radius: 10px;
        }

        .user-info img {
            border-radius: 50%;
            width: 100px;
            height: 100px;
        }

        .redirect-button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #357ae8;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .redirect-button:hover {
            background-color: #2851a3;
        }

        .sign-out-button {
            margin-top: 10px;
            padding: 10px 20px;
            background-color: #ff3333;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .sign-out-button:hover {
            background-color: #cc0000;
        }
    </style>
</head>

<body>
    <div class="container" id="sign-in-container">
        <h1>Google Sign-In</h1>
        <div class="g-signin2" data-onsuccess="onSignIn"></div>
    </div>

    <div class="container" id="welcome-container" style="display: none;">
        <div class="user-info" id="user-info">
            <img src="" alt="Profile Picture" id="profile-pic">
            <h2 id="welcome-message"></h2>
            <p id="email"></p>
        </div>
        <button class="redirect-button" onclick="redirectToResources()">Move to Resources</button>
        <button class="sign-out-button" onclick="signOut()">Sign Out</button>
    </div>

    <script>
        function initClient() {
            gapi.load('auth2', () => {
                gapi.auth2.init({
                    client_id: '1075773109360-rvvcrkes8lbir14cthkbugqus54iq3p7.apps.googleusercontent.com',
                }).then(() => {
                    const auth2 = gapi.auth2.getAuthInstance();

                    // Check if the user is already signed in
                    if (auth2.isSignedIn.get()) {
                        const user = auth2.currentUser.get();
                        onSignIn(user);
                    }
                });
            });
        }

        function onSignIn(googleUser) {
            const profile = googleUser.getBasicProfile();
            const name = profile.getGivenName();
            const email = profile.getEmail();
            const profilePic = profile.getImageUrl();

            // Save user info in sessionStorage
            sessionStorage.setItem('name', name);
            sessionStorage.setItem('email', email);
            sessionStorage.setItem('profilePic', profilePic);

            // Update the UI
            displayWelcomeMessage(name, email, profilePic);
        }

        function displayWelcomeMessage(name, email, profilePic) {
            // Display user info
            document.getElementById('profile-pic').src = profilePic;
            document.getElementById('welcome-message').textContent = `Welcome, ${name}!`;
            document.getElementById('email').textContent = email;

            // Switch UI
            document.getElementById('sign-in-container').style.display = 'none';
            document.getElementById('welcome-container').style.display = 'block';
        }

        function redirectToResources() {
            window.location.href = 'index.html'; // Replace with your actual resources page URL
        }

        function signOut() {
            const auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(() => {
                console.log('User signed out.');
                sessionStorage.clear();
                location.reload(); // Reset UI
            });
        }

        window.onload = () => {
            // Check sessionStorage for user data
            const name = sessionStorage.getItem('name');
            const email = sessionStorage.getItem('email');
            const profilePic = sessionStorage.getItem('profilePic');

            if (name && email && profilePic) {
                // User is already signed in
                displayWelcomeMessage(name, email, profilePic);
            } else {
                // Initialize Google API client
                initClient();
            }
        };
    </script>
</body>

</html>
